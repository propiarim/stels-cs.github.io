<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="theme-color" content="#536878" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo vk apps</title>
    <link rel="manifest" href="/manifest.json">
</head>
<body>

<h1>DEMO VK APPS</h1>

<div></div>

<button class="add-button">Add to home screen</button>

<script src="./vk-connect.js"></script>

<script>
    vkConnect.send('VKWebAppInit', {});
</script>

<script>
	if ('serviceWorker' in navigator) {
		console.log("Will service worker register?");
		navigator.serviceWorker.register('/service-worker.js').then(function(reg){
			console.log("Yes it did.");
		}).catch(function(err) {
			console.log("No it didn't. This happened: ", err)
		});
	}
</script>

<script>
	let deferredPrompt;
	const addBtn = document.querySelector('.add-button');
	addBtn.style.display = 'none';
	window.addEventListener('beforeinstallprompt', (e) => {
		// Prevent Chrome 67 and earlier from automatically showing the prompt
		e.preventDefault();
		// Stash the event so it can be triggered later.
		deferredPrompt = e;
		// Update UI to notify the user they can add to home screen
		addBtn.style.display = 'block';

		addBtn.addEventListener('click', (e) => {
			// hide our user interface that shows our A2HS button
			addBtn.style.display = 'none';
			// Show the prompt
			deferredPrompt.prompt();
			// Wait for the user to respond to the prompt
			deferredPrompt.userChoice.then((choiceResult) => {
				if (choiceResult.outcome === 'accepted') {
					console.log('User accepted the A2HS prompt');
				} else {
					console.log('User dismissed the A2HS prompt');
				}
				deferredPrompt = null;
			});
		});
	});
    </script>
</body>
</html>