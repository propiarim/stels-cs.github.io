<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="theme-color" content="#536878"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover">
    <title>Bug big api</title>
</head>
<body>
<div id="root">git
    <h1>VKWebAppOpenPayFormFailed</h1>
    <p>
        Если успеть тыкнуть на кретик в лоадере, то не придет событие
        VKWebAppOpenPayFormFailed
        <br>

    </p>

    <br/>
    <div id="log"></div>
    <br/>

    <button onclick="test()">VkPay</button>

    <h3>Events:</h3>
    <pre id="console"></pre>


    <script src="./vk-connect.js"></script>

    <script>

		let consoleNode = document.getElementById('console')
		let accessToken = ""

		function test() {
			consolePrint("Call VKWebAppOpenPayForm")
			vkConnect.send('VKWebAppOpenPayForm', {app_id:6825462,action:'pay-to-group',params:{amount:1,description:'test-pay',group_id:58810575}})
		}

		function consolePrint(text, ex) {
			if (ex !== undefined) {
				text += ' ' + JSON.stringify(ex)
			}
			const now = new Date()
			const time = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + ":" + now.getMilliseconds() + 'ms'
			let tn = document.createTextNode(time + ": " + text + "\n")
			consoleNode.prepend(tn)
		}

		vkConnect.subscribe(event => {
			const {type, data} = event.detail
			if (type !== undefined || data !== undefined) {
				if (data === undefined) {
					consolePrint(type + ": " + JSON.stringify(event, null, 2))
				} else {
					consolePrint(type + ": " + JSON.stringify(data, null, 2))
					if (type === 'VKWebAppAccessTokenReceived') {
						accessToken = data.access_token
                        // 600 id пользователей
                        var userIds = [
							432881920,552331778,449188415,552916446,377770582,460727245,496734237,513968689,487890669,542092466,537466648,150956099,361501897,475653666,406545878,139270099,350213483,252590789,250508866,129642951,326683920,496411824,564772491,395136175,438430273,386050251,526077084,528218329,317278929,421284985,281313737,308189325,454370791,550545965,317463479,340129522,429809038,202076344,408016879,557590365,539759463,518942627,382615647,471500696,536605717,196045363,298661308,551814316,183695300,179140972,538319623,493600727,372029619,241229835,371282843,251334231,550588475,558806270,501952135,498735567,545696793,501861160,346497456,412333515,413517729,276231737,436261884,177081371,518412356,527061635,442858474,552872934,494352254,530905876,432037605,272809794,318930870,558569920,410877736,364336717,395802601,487481905,327524732,254406530,254602578,387574591,536645159,558117950,559194425,183670536,462635357,530934059,505605350,408743484,538377183,543285628,332816585,290789607,520092640,543975180,248765596,364829385,460340794,263021381,402713520,261767209,438187578,317058006,534578073,478450124,555860820,381269169,394626246,241789284,369543643,460365265,217810238,348042114,333311694,552411603,396168969,465424789,518253056,233785989,415538797,223342869,550504351,543905553,299028581,559345099,542749096,250736030,470189297,236659614,482141865,234216872,446654159,556091178,298870424,394831795,460585671,462383244,443898488,413453184,170640224,186821693,558067621,357074666,318307775,552235075,480982113,541263734,380030473,341897545,375322856,450179061,445656117,157616170,461837528,557938350,540040635,354262345,427716151,542507499,544694143,344936367,219467392,248392434,301584834,481768238,525858863,240910172,464813134,175721198,511833848,238068384,71248052,195686502,417950396,426990192,499378990,399829656,551033864,206250648,273083825,417904161,169537227,469628763,529266650,485076266,538940127,414071143,200219245,134234755,458253900,192232988,188326073,538277311,488308484,517760702,395260447,481810064,401909676,472095621,320636943,291943743,526280331,391605288,316072479,481828391,537787190,406631102,477219885,530230735,499029575,370689637,173774832,543508824,306444536,532423939,497548302,539012006,353350496,41509712,384461112,466160230,544118154,180128867,290257119,448698726,431149013,328916508,414120692,455706593,530803105,418509390,451375963,432141091,510858869,269494944,282680936,513818932,495744943,519794345,208480259,326533028,370999115,482244022,451768489,547656076,477448801,524653597,353796838,312375949,505337058,217486510,188754590,445684101,466044866,339593086,529741444,5209155,518007150,339906688,202101102,503958914,522215722,465321547,538273480,511427639,207865716,402751225,550172021,424433886,523149923,520436424,546508666,248385419,528085760,285165988,285444226,433407309,550783971,506471085,477423192,550845665,507453548,373892515,307449186,366903589,287974519,446910988,544969057,524321102,297881757,447370486,548324863,293812856,515361133,385764349,157643844,314925051,181008197,547686703,492606105,334615933,133600891,353429220,321509381,300193500,146240194,163322163,474241629,464443889,410002223,544378613,350408652,502420416,304335625,549596257,516252744,371310302,497763242,427674986,451477721,478942942,537284230,432629962,355971508,533071811,414643676,287878896,387041349,406253348,450142121,521212193,538812371,231292422,520418242,478996387,469028974,352690296,457178734,480105248,467245661,541907405,468267338,515721404,226302018,328431452,506482185,503459134,534826228,381090986,515498823,469255712,458707717,151016468,522006312,203664831,543498378,415448506,353701087,544072299,522002522,519599261,335481663,327725136,452334047,227439355,404957615,414854304,545341138,174404708,489141433,334801041,133510102,258033705,523783969,350889922,448051598,178594640,432246731,461479896,451866010,233081914,360940926,375096566,524730235,227332597,255292025,455095297,303039929,379741897,397080371,463120991,541653764,381725428,397613027,528155775,430860501,444245708,532412338,477955807,316646078,489095517,502993012,535747738,244739253,207180353,472972931,505351348,273986123,505624880,365818477,444743978,489039372,454083819,240755223,363338750,236730510,210966142,538608776,301072942,357062081,528652458,453589859,309096913,374978885,140106153,514563042,472581292,502787447,516068091,305863578,260655070,414845072,165563130,464730905,303972184,360522456,455709773,523641341,534722666,239947115,436614637,337810480,276062459,179858020,506769051,309430620,257854350,516849050,506912180,246723515,438935124,16670786,286913022,324484785,161498915,297351951,488081916,252743732,344368203,260408220,531999427,494865701,497756778,499669030,419487604,431372442,455536924,464401354,183873300,392822770,204229666,51666361,336966274,254315815,282487159,330356546,428877688,471075956,543262779,516867318,400484820,487746590,321932807,536175913,144870046,407845583,541548785,366450367,407066735,243636208,486838367,541871050,399542145,431324827,376876001,411115544,162409215,451802277,535456490,385010812,447984705,516182834,80776681,489484537,391814323,359347131,174553773,405134290,542292499,362288969,464840985,532832206,504580897,381517287,126415089,473150652,347306075,496461315,271447521,508301958,403719844,524371270,338070354,41386138,196099979,533910673,488020883,442271433,160968253,505837900,423096632,539178268,355275831,226335993,514831385,318306324,174501763,430072751,339840211,199691188,134543244,535138331,326432206,491675827,483780779,221165903,536087767,492443081,444327131,539987828,415881917,492213122,392413035,517057081,335696753,476913701,458754190,327272507,397090460,366820471,419678137,248379057,447281231,464406656,283430510,537861003,224706906,208462071,497846661,347801501,467869716,238312202,494250525,254375055,527912242,529498956,371526964,388090193,466647403,502932871,357657770,505832044,435906353,462508090,287365085,462947454,395745955,468709243,506352150,219657855,250932453,295921307,512606009,443345683,531517882,432639867,254748802,481596220,285574961,37323553,475547284,415205943,500903365,520150172,428506247,337241497,531321182,462011590,458477250,370799713,348016070,375990149,335997025,520130840,438168793,534729325,297806260,388789560,478233870,484250151,267681424,410677278,359648476,388165969,422112601,468822465,446349993,538382781,369673000,288130372,413520868,291907066,448550708,408547804,109512214,406874846,527521270,211426266,352404489,401998505,334235922,527225088,518747015,482829553,347828769,303087380,370191884,458449001,471594632,222472195,481307519,494372262,298824443,481865200,311034322,253519079,456606503,
                        ]
						vkConnect.send("VKWebAppCallAPIMethod", {
							"method": "users.get", "params":
								{
									"user_ids": userIds.join(','),
									"v": "5.92",
									"access_token": accessToken
								}, "request_id": 99564
						})
					}
				}

				if (window.location.href.indexOf('vk_platform=mobile_web') !== -1) {
					if (type === 'VKWebAppUpdateConfig') {
						const root = document.getElementById('root')
						root.style.maxHeight = data.viewport_height + 'px'
						root.style.height = data.viewport_height + 'px'
						root.style.overflow = 'auto'
						root.style.webkitOverflowScrolling = 'touch'
					}
				}

			} else {
				consolePrint(JSON.stringify(event, null, 2))
			}
		})

		vkConnect.send('VKWebAppInit', {})


    </script>
</div>
</body>
</html>
